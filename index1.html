<!DOCTYPE html>
<html>
  <head>
    <title>In-System Programmer</title>
  </head>
  <body onload="createTimeline()" style="background-color:#333333">
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/smoothie/1.29.1/smoothie.min.js"></script>
    <script type="text/javascript">
		var dpAd0 = [];
		var dataPos = 0;
		var lastTs = 0;
		var random = new TimeSeries();
		
		setInterval(function() {
			random.append(new Date().getTime(), dpAd0[dataPos]);
			dataPos = dataPos + 1;
			if (dataPos==20) {
				dataPos = 0;
			}
		}, 100);

		function createTimeline() {
			var chart = new SmoothieChart({maxValue:65536, minValue:0, millisPerPixel:15, timestampFormatter:SmoothieChart.timeFormatter});
			chart.addTimeSeries(random, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 0, 0, 0)', lineWidth: 1 });
			chart.streamTo(document.getElementById("chart"), 0);
		}
      
		setInterval(function() {
			jQuery.ajax({
				url : "https://agent.electricimp.com/dkUshR_qyJMr/ad0",
				crossDomain: true
			}).done(function(data){
				console.log(data.ts);
				if (lastTs < data.ts) {
					console.log(data.ad0);
					for (j=0;j<20;j++) {
						dpAd0[j] = data.ad0[j];
					}
					dataPos = 0;
					lastTs = data.ts;
				}

			});
		}, 1000);
		  
    </script>
    <canvas id="chart" width="800" height="400"></canvas>
	
  </body>
</html>
