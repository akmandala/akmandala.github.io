<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Imp Explorer Kit</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        /* Space out content a bit */
        body {
        padding-top: 20px;
        padding-bottom: 20px;
        }
        .wide-button {
            min-width: 80px;
        }
        .vbottom {
            vertical-align: bottom;
        }
        .inline-group {
            /* Add to make a .form-group more like a .btn */
            display: inline-block;
            margin-bottom: 0;
        }
        .raise-8px {
            /* Vertically center label relative to button even when vertical-align is bottom. */
            position: relative;
            top: -8px;
        }
        .jquery-hidden {
            /* Bootstrap defines a .hidden which is different to JQuery's idea of hidden. */
            display: none;
        }
    </style>
  </head>
  <body onload="createTimeline()">
      <div class="container">

        <div class="jumbotron">
            <h1><nobr>Smart Body Mat</nobr> <a href="http://electricimp.com/"><img
                    src="//electricimp.com/public/img/logosmall.png" alt="[logo]"></a></h1>
            <p>Smart Mattress Sensors cloud data acquisition</p>
        </div>
	
		<div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Upper body pressure Left & Right</h3>
            </div>
            <div class="panel-body">
				<canvas id="chart1" width="600" height="400"></canvas>
            </div>
        </div>	
		
		<div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Middle body pressure Left & Right</h3>
            </div>
            <div class="panel-body">
				<canvas id="chart2" width="600" height="400"></canvas>
            </div>
        </div>	
		
		<div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">Lower body pressure Left & Right</h3>
            </div>
            <div class="panel-body">
				<canvas id="chart3" width="600" height="400"></canvas>
            </div>		
        </div>			

	  </div>	

    <footer class="bs-docs-footer">
        <div class="container">
             Electric Imp and the Electric Imp logo are trademarks of
                <a href="http://electricimp.com/" target="_blank">Electric Imp, Inc</a>.
        </div>
    </footer>	  
	
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/smoothie/1.29.1/smoothie.min.js"></script>
	<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script type="text/javascript">
		var dpAdc0 = [];
		var dpAdc1 = [];
		var dpAdc2 = [];
		var dpAdc3 = [];
		var dpAdc4 = [];
		var dpAdc5 = [];		
		
		var dataPos = 0;
		var lastTs = 0;
		var Adc0 = new TimeSeries();
		var Adc1 = new TimeSeries();
		var Adc2 = new TimeSeries();
		var Adc3 = new TimeSeries();
		var Adc4 = new TimeSeries();
		var Adc5 = new TimeSeries();
		
		function createTimeline() {
			var chart1 = new SmoothieChart({maxValue:4, minValue:0, millisPerPixel:10, timestampFormatter:SmoothieChart.timeFormatter});
			chart1.addTimeSeries(Adc0, { strokeStyle: 'rgba(0, 0, 255, 1)', fillStyle: 'rgba(0, 0, 0, 0)', lineWidth: 1 });
			chart1.addTimeSeries(Adc1, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 0, 0, 0)', lineWidth: 1 });
			chart1.streamTo(document.getElementById("chart1"), 0);
			
			var chart2 = new SmoothieChart({maxValue:4, minValue:0, millisPerPixel:10, timestampFormatter:SmoothieChart.timeFormatter});
			chart2.addTimeSeries(Adc2, { strokeStyle: 'rgba(0, 0, 255, 1)', fillStyle: 'rgba(0, 0, 0, 0)', lineWidth: 1 });
			chart2.addTimeSeries(Adc3, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 0, 0, 0)', lineWidth: 1 });
			chart2.streamTo(document.getElementById("chart2"), 0);			

			var chart3 = new SmoothieChart({maxValue:4, minValue:0, millisPerPixel:10, timestampFormatter:SmoothieChart.timeFormatter});
			chart3.addTimeSeries(Adc4, { strokeStyle: 'rgba(0, 0, 255, 1)', fillStyle: 'rgba(0, 0, 0, 0)', lineWidth: 1 });
			chart3.addTimeSeries(Adc5, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 0, 0, 0)', lineWidth: 1 });			
			chart3.streamTo(document.getElementById("chart3"), 0);					
		}
				
		setInterval(function() {
			var timeStmp = new Date().getTime();
			Adc0.append(timeStmp, dpAdc0[dataPos]);
			Adc1.append(timeStmp, dpAdc1[dataPos]);
			Adc2.append(timeStmp, dpAdc2[dataPos]);
			Adc3.append(timeStmp, dpAdc3[dataPos]);
			Adc4.append(timeStmp, dpAdc4[dataPos]);
			Adc5.append(timeStmp, dpAdc5[dataPos]);

			updateChart(dataPos); 
			
			dataPos = dataPos + 1;
			if (dataPos==10) {
				dataPos = 0;
			}
		}, 100);
      
		setInterval(function() {
			jQuery.ajax({
				url : "https://agent.electricimp.com/ksK46MtcFbSk/sensor",
				crossDomain: true
			}).done(function(data){
				if (lastTs != data.ts) {
					if(data.hasOwnProperty('sensor')){
						for (j=0;j<10;j++) {
							if(data.sensor.hasOwnProperty('adc0')){
								dpAdc0[j] = data.sensor.adc0[j];
							}
							if(data.sensor.hasOwnProperty('adc1')){
								dpAdc1[j] = data.sensor.adc1[j];
							}
							if(data.sensor.hasOwnProperty('adc2')){
								dpAdc2[j] = data.sensor.adc2[j];
							}
							if(data.sensor.hasOwnProperty('adc3')){
								dpAdc3[j] = data.sensor.adc3[j];
							}
							if(data.sensor.hasOwnProperty('adc4')){
								dpAdc4[j] = data.sensor.adc4[j];
							}
							if(data.sensor.hasOwnProperty('adc5')){
								dpAdc5[j] = data.sensor.adc5[j];
							}
							dataPos = 0;
						}
					}
					lastTs = data.ts;
				}

			});
		}, 1000);
		  
    </script>
	
  </body>
</html>
