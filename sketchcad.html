<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>sketchCAD – Sketch → Schematic → PCB → BoM → Enclosure</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!--
    sketchCAD – static MVP demo

    File placement for GitHub Pages / Netlify:

      - KiCad schematic for KiCanvas:
          /kicad/example.kicad_sch

      - KiCad PCB for KiCanvas:
          /kicad/example.kicad_pcb

      - STEP model for 3D viewer (remote URL – edit iframe src below):
          https://mydomain.com/models/example.step

      - Design bundle ZIP:
          /downloads/sketchcad_photogrammetry_rig_demo.zip

    BoM:
      - Simple HTML table in the BoM tab; edit rows as needed.
  -->

  <style>
    :root {
      --bg-body: #f3f4f6;
      --bg-surface: #ffffff;
      --border-subtle: #e5e7eb;
      --border-strong: #d1d5db;
      --text-main: #111827;
      --text-muted: #6b7280;
      --accent: #10a37f;
      --radius-lg: 0.75rem;
      --radius-md: 0.5rem;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: var(--bg-body);
      color: var(--text-main);
    }

    #app {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    /* Header (simple, GPT-ish) */

    .app-header {
      position: sticky;
      top: 0;
      z-index: 10;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      padding: 0.75rem 1.25rem;
      background: var(--bg-surface);
      border-bottom: 1px solid var(--border-subtle);
    }

    .header-left {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
    }

    .header-title {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .header-subtitle {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .header-project {
      font-size: 0.78rem;
      padding: 0.15rem 0.6rem;
      border-radius: 999px;
      border: 1px solid var(--border-subtle);
      background: #f9fafb;
      color: var(--text-muted);
    }

    .btn {
      font-family: inherit;
      font-size: 0.8rem;
      font-weight: 500;
      border-radius: 999px;
      border: 1px solid var(--border-strong);
      padding: 0.4rem 0.9rem;
      background: #ffffff;
      color: var(--text-main);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      transition:
        background 0.15s ease,
        border-color 0.15s ease,
        box-shadow 0.15s ease,
        transform 0.05s ease;
      white-space: nowrap;
    }

    .btn:hover {
      background: #f9fafb;
      border-color: var(--border-strong);
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.12);
      transform: translateY(-0.5px);
    }

    .btn-primary {
      border-color: var(--accent);
      background: var(--accent);
      color: #ffffff;
    }

    .btn-primary:hover {
      background: #0d8c6d;
    }

    .btn-small {
      padding: 0.32rem 0.75rem;
      font-size: 0.78rem;
    }

    .btn svg {
      width: 14px;
      height: 14px;
    }

    /* Main layout ---------------------------------------------- */

    .app-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 0.75rem 1.25rem 1rem;
      gap: 0.75rem;
    }

    /* Static prompt on top (GPT-like) */

    .prompt-panel {
      background: var(--bg-surface);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      padding: 0.75rem 0.9rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
    }

    .prompt-label {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    .prompt-input {
      width: 100%;
      min-height: 80px;
      max-height: 180px;
      resize: vertical;
      padding: 0.6rem 0.7rem;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      outline: none;
      font-size: 0.86rem;
      line-height: 1.4;
      background: #ffffff;
    }

    .prompt-input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(16, 163, 127, 0.25);
    }

    .prompt-actions-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-top: 0.2rem;
    }

    .prompt-buttons {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .status-text {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Bottom: big workspace (left) + thinking panel (right) ------ */

    .main-layout {
      flex: 1;
      display: grid; /* IMPORTANT: two-column layout */
      grid-template-columns: minmax(0, 3fr) minmax(260px, 1.4fr);
      gap: 0.75rem;
      min-height: 0;
    }

    /* Workspace / tabs */

    .workspace {
      background: var(--bg-surface);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .tabs-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.4rem 0.65rem;
      border-bottom: 1px solid var(--border-subtle);
      gap: 0.5rem;
    }

    .tabs-list {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
    }

    .tab-button {
      border-radius: 999px;
      border: 1px solid transparent;
      background: transparent;
      padding: 0.25rem 0.65rem;
      font-size: 0.78rem;
      color: var(--text-muted);
      cursor: pointer;
      transition:
        background 0.15s ease,
        border-color 0.15s ease,
        color 0.15s ease;
    }

    .tab-button:hover {
      background: #f3f4f6;
      color: #111827;
    }

    .tab-button.active {
      background: #e5f5f0;
      border-color: var(--accent);
      color: #065f46;
    }

    .zoom-control {
      display: flex;
      align-items: center;
      gap: 0.4rem;
      font-size: 0.75rem;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .zoom-control input[type="range"] {
      width: 90px;
      accent-color: var(--accent);
    }

    .tab-content {
      position: relative;
      flex: 1;
      min-height: 0;
    }

    .tab-panel {
      position: absolute;
      inset: 0;
      padding: 0.75rem;
      overflow: auto;
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    .tab-panel-inner {
      transform-origin: top left;
    }

    .panel-title {
      font-size: 0.86rem;
      font-weight: 500;
      margin-bottom: 0.25rem;
    }

    .panel-subtitle {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-bottom: 0.65rem;
    }

    /* Sketch tab */

    .sketch-toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
      margin-bottom: 0.5rem;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .sketch-toolbar-left {
      display: flex;
      gap: 0.4rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .sketch-note {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    #sketch-canvas {
      width: 100%;
      max-width: 100%;
      aspect-ratio: 2 / 1;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      background: #ffffff;
      cursor: crosshair;
      display: block;
    }

    .sketch-footer {
      margin-top: 0.4rem;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* Blocks tab */

    .block-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 0.5rem;
    }

    .block-card {
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      padding: 0.55rem 0.6rem;
      font-size: 0.78rem;
    }

    .block-card-title {
      font-weight: 500;
      margin-bottom: 0.18rem;
    }

    .block-card-sub {
      font-size: 0.74rem;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    .block-card-tags {
      font-size: 0.74rem;
      color: var(--text-muted);
    }

    /* Schematic / PCB embeds */

    .embed-note {
      font-size: 0.78rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }

    kicanvas-embed {
      display: block;
      width: 100%;
      height: min(520px, 70vh);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      background: #f9fafb;
    }

    /* BoM */

    .bom-table-wrapper {
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      overflow: hidden;
      font-size: 0.78rem;
      background: #ffffff;
    }

    table.bom-table {
      width: 100%;
      border-collapse: collapse;
    }

    table.bom-table th,
    table.bom-table td {
      border-bottom: 1px solid var(--border-subtle);
      padding: 0.45rem 0.6rem;
      text-align: left;
    }

    table.bom-table thead {
      background: #f9fafb;
    }

    table.bom-table th {
      font-size: 0.75rem;
      font-weight: 500;
      color: var(--text-muted);
    }

    table.bom-table tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    .bom-caption {
      padding: 0.4rem 0.6rem;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    /* FreeCAD macro */

    .macro-wrapper {
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      background: #f9fafb;
      overflow: hidden;
      font-size: 0.78rem;
    }

    .macro-header {
      padding: 0.4rem 0.6rem;
      border-bottom: 1px solid var(--border-subtle);
      color: var(--text-muted);
      font-size: 0.75rem;
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      align-items: center;
    }

    pre.macro-placeholder {
      margin: 0;
      padding: 0.6rem;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 0.76rem;
      background: #f9fafb;
      overflow: auto;
      min-height: 160px;
    }

    /* Extrusion / 3D viewer */

    .extrusion-wrapper {
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      background: #f9fafb;
      display: flex;
      flex-direction: column;
      min-height: 260px;
      max-height: 70vh;
    }

    .extrusion-header {
      padding: 0.4rem 0.6rem;
      border-bottom: 1px solid var(--border-subtle);
      font-size: 0.75rem;
      color: var(--text-muted);
      display: flex;
      justify-content: space-between;
      gap: 0.5rem;
      align-items: center;
    }

    .extrusion-url {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 0.72rem;
      color: var(--text-muted);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .extrusion-viewer {
      flex: 1;
      border: none;
      width: 100%;
    }

    /* Reasoning panel (thinking column) */

    .reasoning-panel {
      background: var(--bg-surface);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      padding: 0.75rem;
      display: flex;
      flex-direction: column;
      min-height: 0;
    }

    .reasoning-header-text {
      font-size: 0.86rem;
      font-weight: 500;
      margin-bottom: 0.1rem;
    }

    .reasoning-subtitle {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-bottom: 0.4rem;
    }

    .reasoning-log {
      flex: 1;
      overflow: auto;
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
      font-size: 0.78rem;
    }

    .reasoning-entry {
      border-radius: var(--radius-md);
      border: 1px solid var(--border-subtle);
      padding: 0.45rem 0.55rem;
      background: #f9fafb;
    }

    .reasoning-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.4rem;
      margin-bottom: 0.2rem;
    }

    .reasoning-title {
      font-weight: 500;
      font-size: 0.78rem;
    }

    .reasoning-time {
      font-size: 0.72rem;
      color: var(--text-muted);
      font-variant-numeric: tabular-nums;
    }

    .reasoning-body {
      color: var(--text-muted);
      white-space: pre-line;
    }

    .reasoning-footer-note {
      margin-top: 0.5rem;
      font-size: 0.74rem;
      color: var(--text-muted);
    }

    /* Footer */

    .app-footer {
      padding: 0.45rem 1.25rem 0.7rem;
      font-size: 0.75rem;
      color: var(--text-muted);
      border-top: 1px solid var(--border-subtle);
      background: #f9fafb;
      display: flex;
      justify-content: space-between;
      gap: 0.75rem;
      flex-wrap: wrap;
    }

    /* Responsive tweaks */

    @media (max-width: 900px) {
      .main-layout {
        grid-template-columns: minmax(0, 1.9fr) minmax(0, 1.3fr);
      }
    }

    @media (max-width: 780px) {
      .app-main {
        padding: 0.75rem 0.75rem 1rem;
      }

      .app-header {
        padding-left: 0.75rem;
        padding-right: 0.75rem;
        flex-direction: column;
        align-items: flex-start;
      }

      .header-right {
        width: 100%;
        justify-content: space-between;
      }

      .main-layout {
        grid-template-columns: minmax(0, 1fr); /* stack on mobile */
      }
    }

    @media (max-width: 520px) {
      .tabs-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .zoom-control {
        align-self: flex-end;
      }

      .prompt-actions-row {
        flex-direction: column-reverse;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- Header -------------------------------------------------------------->
    <header class="app-header">
      <div class="header-left">
        <div class="header-title">
          sketchCAD – Sketch → Schematic → PCB → BoM → Enclosure
        </div>
        <div class="header-subtitle">
          Static MVP – sketch-driven CAD+EDA workflow
        </div>
      </div>
      <div class="header-right">
        <div class="header-project">
          Project: CM5 Photogrammetry Rig
        </div>
        <a
          class="btn btn-primary btn-small"
          href="sketchcad_photogrammetry_rig.zip"
          download
        >
          <svg viewBox="0 0 20 20" aria-hidden="true">
            <path
              d="M10 2.25c.414 0 .75.336.75.75v7.19l2.116-2.115a.75.75 0 1 1 1.06 1.06l-3.5 3.5a.748.748 0 0 1-.53.22h-.002a.748.748 0 0 1-.53-.22l-3.5-3.5a.75.75 0 0 1 1.06-1.06L9.25 10.19V3c0-.414.336-.75.75-.75Z"
              fill="currentColor"
            ></path>
            <path
              d="M4.5 12.75a.75.75 0 0 1 .75.75v1.25c0 .414.336.75.75.75h8a.75.75 0 0 0 .75-.75V13.5a.75.75 0 0 1 1.5 0v1.25A2.25 2.25 0 0 1 14 17H6a2.25 2.25 0 0 1-2.25-2.25V13.5a.75.75 0 0 1 .75-.75Z"
              fill="currentColor"
            ></path>
          </svg>
          <span>.zip bundle</span>
        </a>
      </div>
    </header>

    <!-- Main content -------------------------------------------------------->
    <main class="app-main">
      <!-- Prompt panel (static, GPT-style) -->
      <section class="prompt-panel">
        <div class="prompt-label">
          sketchCAD prompt – describe or correct the intent here.
        </div>
        <textarea
          id="design-intent-input"
          class="prompt-input"
          placeholder="Describe your hardware idea in natural language..."
        >Project: Photogrammetry Rig using CM5

Goals:
- 2× camera connectors.
- CM5 compute core with deepX accelerator via PCIe.
- USB-C power 5V / 3A (no PD).
- Ethernet + SD card for data ingest/export.
- mmWave gesture sensor on the front edge of the enclosure for operator UI + RGB LED feedback.

Constraints:
- Enclosure to house ~160×160 mm PCB, aluminum extrusion.
- Camera connectors + mmWave sensor + RGB LED on the front, user I/O (Ethernet / SD / power) on the rear.</textarea>

        <div class="prompt-actions-row">
          <div class="prompt-buttons">
            <button id="btn-apply-intent" class="btn btn-primary btn-small">
              Apply intent
            </button>
            <button id="btn-regenerate" class="btn btn-small">
              Regenerate
            </button>
          </div>
        </div>
        <div id="status-text" class="status-text">
          Ready. Loaded CM5 Photogrammetry Rig example.
        </div>
      </section>

      <!-- Bottom: workspace + reasoning panel -->
      <section class="main-layout">
        <!-- Workspace (tabs) -->
        <section class="workspace">
          <div class="tabs-header">
            <div class="tabs-list">
              <button class="tab-button active" type="button" data-tab-target="tab-sketch">
                Sketch
              </button>
              <button class="tab-button" type="button" data-tab-target="tab-blocks">
                Blocks
              </button>
              <button class="tab-button" type="button" data-tab-target="tab-schematic">
                Schematic
              </button>
              <button class="tab-button" type="button" data-tab-target="tab-pcb">
                PCB
              </button>
              <button class="tab-button" type="button" data-tab-target="tab-bom">
                BoM
              </button>
              <button class="tab-button" type="button" data-tab-target="tab-freecad">
                FreeCAD Macro
              </button>
              <button class="tab-button" type="button" data-tab-target="tab-extrusion">
                Extrusion
              </button>
            </div>
            <div class="zoom-control">
              <label for="zoom-range">Zoom</label>
              <input id="zoom-range" type="range" min="60" max="180" value="100" />
              <span id="zoom-value">100%</span>
            </div>
          </div>

          <div class="tab-content">
            <!-- Sketch Tab -->
            <div id="tab-sketch" class="tab-panel active">
              <div class="tab-panel-inner">
                <h3 class="panel-title">Sketch</h3>
                <p class="panel-subtitle">
                  Input sketch: electronics and enclosure face plates. sketchCAD to interpret it.
                </p>

                <div class="sketch-toolbar">
                  <div class="sketch-toolbar-left">
                    <button id="sketch-clear" class="btn btn-small">Clear sketch</button>
                    <button id="sketch-apply" class="btn btn-primary btn-small">
                      Apply sketch
                    </button>
                  </div>
                  <div class="sketch-note">
                    Draw block diagram for CM5 Photogrammetry Rig.
                  </div>
                </div>

                <canvas id="sketch-canvas" width="1000" height="500"></canvas>

                <div class="sketch-footer">
                  Typical demo script: input sketch, apply it, then flip to Blocks / Schematic / PCB / BoM / Enclosure design.
                </div>
              </div>
            </div>

            <!-- Blocks Tab -->
            <div id="tab-blocks" class="tab-panel">
              <div class="tab-panel-inner">
                <h3 class="panel-title">High-level Blocks – CM5 Photogrammetry Rig</h3>
                <p class="panel-subtitle">
                  Blocks interpreted from sketch.
                </p>

                <div class="block-grid">
                  <div class="block-card">
                    <div class="block-card-title">CM5 Compute Module</div>
                    <div class="block-card-sub">
                      Central controller for capture orchestration, storage and networking.
                    </div>
                    <div class="block-card-tags">
                      PCIe → deepX · GigE · SDIO
                    </div>
                  </div>

                  <div class="block-card">
                    <div class="block-card-title">deepX AI Module</div>
                    <div class="block-card-sub">
                      Hardware accelerator for real-time feature extraction on captured frames.
                    </div>
                    <div class="block-card-tags">
                      PCIe x1 · 3V3 / 5V rails
                    </div>
                  </div>

                  <div class="block-card">
                    <div class="block-card-title">Camera connectors (2×)</div>
                    <div class="block-card-sub">
                      Dual cameras for stereo photogrammetry.
                    </div>
                    <div class="block-card-tags">
                      CS0 &amp; CS1 · 2× trigger lines · I²C config
                    </div>
                  </div>

                  <div class="block-card">
                    <div class="block-card-title">Power Input + DCDC</div>
                    <div class="block-card-sub">
                      USB‑C (5 V / 3 A, no PD) and optional PoE input.
                    </div>
                    <div class="block-card-tags">
                      PoE 7–36 V in · USB‑C 5 V / 3 A · mmWave rail
                    </div>
                  </div>

                  <div class="block-card">
                    <div class="block-card-title">Ethernet + SD Card</div>
                    <div class="block-card-sub">
                      Network control and removable storage for the rig.
                    </div>
                    <div class="block-card-tags">
                      RJ45 · microSD socket
                    </div>
                  </div>

                  <div class="block-card">
                    <div class="block-card-title">mmWave Gesture Sensor + RGB LED</div>
                    <div class="block-card-sub">
                      Hands‑free gesture trigger and visual feedback on the front of the enclosure.
                    </div>
                    <div class="block-card-tags">
                      I²C / UART · IRQ → CM5 · RGB LED driver
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Schematic Tab -->
            <div id="tab-schematic" class="tab-panel">
              <div class="tab-panel-inner">
                <h3 class="panel-title">Top-level schematic (KiCanvas)</h3>
                <p class="panel-subtitle">
                  Single schematic file with CM5, deepX, camera connectors, power input, Ethernet, SD card and mmWave sensor.
                </p>

                <div class="embed-note">
                  KiCanvas will render below once you add the KiCanvas web component loader and place a KiCad schematic at:
                  <code>example.kicad_sch</code>.
                </div>

                <!-- Place your KiCad schematic at /kicad/example.kicad_sch -->
                <kicanvas-embed src="example.kicad_sch"></kicanvas-embed>
              </div>
            </div>

            <!-- PCB Tab -->
            <div id="tab-pcb" class="tab-panel">
              <div class="tab-panel-inner">
                <h3 class="panel-title">PCB placement &amp; outline (KiCanvas)</h3>
                <p class="panel-subtitle">
                  Connectors on the front edge, CM5 + deepX near the center, power and rear I/O grouped logically.
                </p>

                <div class="embed-note">
                  KiCanvas will render below once you place a KiCad PCB file at:
                  <code>example.kicad_pcb</code>
                </div>

                <!-- Place your KiCad PCB at /kicad/example.kicad_pcb -->
                <kicanvas-embed src="example.kicad_pcb"></kicanvas-embed>
              </div>
            </div>

            <!-- BoM Tab -->
            <div id="tab-bom" class="tab-panel">
              <div class="tab-panel-inner">
                <h3 class="panel-title">BoM – CM5 Photogrammetry Rig</h3>
                <p class="panel-subtitle">
                  Minimal BoM.
                </p>

                <div class="bom-table-wrapper">
                  <table class="bom-table">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Designators</th>
                        <th>Part Number</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>1</td>
                        <td>U1</td>
                        <td>CM5-PLACEHOLDER – Compute Module 5</td>
                      </tr>
                      <tr>
                        <td>2</td>
                        <td>U2</td>
                        <td>DEEPX-ACCEL-PLACEHOLDER – deepX AI accelerator module</td>
                      </tr>
                      <tr>
                        <td>3</td>
                        <td>J1–J2</td>
                        <td>CAM-CONN-PLACEHOLDER – 2× camera connectors</td>
                      </tr>
                      <tr>
                        <td>4</td>
                        <td>PS1</td>
                        <td>DCDC-12V-PLACEHOLDER – PoE / USB‑C front-end &amp; DCDC</td>
                      </tr>
                      <tr>
                        <td>5</td>
                        <td>J3</td>
                        <td>ETH-RJ45-PLACEHOLDER – Ethernet jack with magnetics</td>
                      </tr>
                      <tr>
                        <td>6</td>
                        <td>J4</td>
                        <td>MICROSD-PLACEHOLDER – microSD card connector</td>
                      </tr>
                      <tr>
                        <td>7</td>
                        <td>U3</td>
                        <td>MMWAVE-GESTURE-PLACEHOLDER – mmWave gesture sensor</td>
                      </tr>
                    </tbody>
                  </table>
                  <div class="bom-caption">
                    Edit these rows directly in this file or replace with a generated BoM later.
                  </div>
                </div>
              </div>
            </div>

            <!-- FreeCAD Macro Tab -->
            <div id="tab-freecad" class="tab-panel">
              <div class="tab-panel-inner">
                <h3 class="panel-title">FreeCAD enclosure macro (placeholder)</h3>
                <p class="panel-subtitle">
                  Placeholder macro region. For the pitch, scroll through and talk about parametric enclosure generation.
                </p>

                <div class="macro-wrapper">
                  <div class="macro-header">
                    <span>FreeCAD macro – not executed in the browser.</span>
                  </div>
                  <pre class="macro-placeholder">
# sketchCAD – photogrammetry rig enclosure macro (placeholder)
#
# This code is here only to make the MVP feel real. It is never executed
# by the web page.
#
# Expected behavior (once wired up for real):
#   - Reads the PCB outline from a STEP/board file
#   - Builds a simple enclosure around it (width/height/depth)
#   - Adds cutouts for camera connectors and mmWave sensor
#   - Exports a STEP model that matches the Extrusion tab

import FreeCAD as App
import FreeCADGui as Gui
import Part

DOC_NAME = "sketchCAD_Photogrammetry_Enclosure"

def ensure_doc():
    if App.ActiveDocument is None or App.ActiveDocument.Name != DOC_NAME:
        App.newDocument(DOC_NAME)
    return App.ActiveDocument

def build_demo_enclosure(board_length=160.0, board_width=160.0, height=70.0):
    doc = ensure_doc()

    base = Part.makeBox(board_length, board_width, height)
    base.translate(App.Vector(-board_length/2, -board_width/2, 0))

    obj = doc.addObject("Part::Feature", "DemoEnclosure")
    obj.Shape = base
    doc.recompute()
    return obj

if __name__ == "__main__":
    build_demo_enclosure()</pre>
                </div>
              </div>
            </div>

            <!-- Extrusion Tab -->
            <div id="tab-extrusion" class="tab-panel">
              <div class="tab-panel-inner">
                <h3 class="panel-title">3D enclosure view (STEP via 3dviewer.net)</h3>
                <p class="panel-subtitle">
                  STEP file is hosted externally and embedded via iframe.
                </p>

                <div class="extrusion-wrapper">
                  <div class="extrusion-header">
                    <span>Read-only STEP preview.</span>
                    <span class="extrusion-url">
                      https://3dviewer.net/#model=https://akmandala.github.io/1457T1601BK.stp
                    </span>
                  </div>
                  <iframe
                    class="extrusion-viewer"
                    src="https://3dviewer.net/#model=https://akmandala.github.io/1457T1601BK.stp"
                    loading="lazy"
                    title="CM5 Photogrammetry rig enclosure"
                    allowfullscreen
                  ></iframe>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Reasoning / thinking panel (right column) -->
        <aside class="reasoning-panel">
          <div>
            <div class="reasoning-header-text">AI Reasoning (sketchCAD)</div>
            <div class="reasoning-subtitle">
              Simple log of fake “thinking” steps. Updated when you click Apply intent, Apply sketch, or Regenerate.
            </div>
          </div>
          <div id="reasoning-log" class="reasoning-log">
            <!-- Entries are injected by JS -->
          </div>
          <div class="reasoning-footer-note">
            Narrate these steps as if sketchCAD were actually re-synthesizing the design from sketch + intent.
          </div>
        </aside>
      </section>
    </main>

    <footer class="app-footer">
      <span>
        sketchCAD MVP – static front-end only. Safe for GitHub Pages / Netlify, no backend dependencies.
      </span>
      <span>
        Demo example: CM5 Photogrammetry Rig. Swap in any other design while keeping the same flow.
      </span>
    </footer>
  </div>

  <script>
    (function () {
      // --- Tab switching ----------------------------------------------------
      const tabButtons = document.querySelectorAll("[data-tab-target]");
      const tabPanels = document.querySelectorAll(".tab-panel");

      function activateTab(id) {
        tabButtons.forEach((btn) => {
          const isActive = btn.getAttribute("data-tab-target") === id;
          btn.classList.toggle("active", isActive);
        });
        tabPanels.forEach((panel) => {
          panel.classList.toggle("active", panel.id === id);
        });
      }

      tabButtons.forEach((btn) => {
        btn.addEventListener("click", () => {
          const target = btn.getAttribute("data-tab-target");
          if (target) activateTab(target);
        });
      });

      // --- Reasoning log helpers -------------------------------------------
      const reasoningLogEl = document.getElementById("reasoning-log");
      const statusTextEl = document.getElementById("status-text");

      function setStatus(message) {
        if (statusTextEl) statusTextEl.textContent = message;
      }

      function appendReasoning(title, bodyText) {
        if (!reasoningLogEl) return;

        const entry = document.createElement("div");
        entry.className = "reasoning-entry";

        const meta = document.createElement("div");
        meta.className = "reasoning-meta";

        const titleSpan = document.createElement("div");
        titleSpan.className = "reasoning-title";
        titleSpan.textContent = title;

        const timeSpan = document.createElement("div");
        timeSpan.className = "reasoning-time";
        try {
          timeSpan.textContent = new Date().toLocaleTimeString();
        } catch {
          timeSpan.textContent = "--:--";
        }

        meta.appendChild(titleSpan);
        meta.appendChild(timeSpan);

        const body = document.createElement("div");
        body.className = "reasoning-body";
        body.textContent = bodyText;

        entry.appendChild(meta);
        entry.appendChild(body);

        // Prepend newest at top
        reasoningLogEl.prepend(entry);
      }

      // --- Design Intent buttons -------------------------------------------
      const designIntentInput = document.getElementById("design-intent-input");
      const btnApplyIntent = document.getElementById("btn-apply-intent");
      const btnRegenerate = document.getElementById("btn-regenerate");

      function summarizeIntent() {
        if (!designIntentInput) return "No Design Intent text.";
        const text = designIntentInput.value.trim();
        if (!text) return "No Design Intent text.";
        if (text.length <= 200) return text;
        return text.slice(0, 200) + "…";
      }

      if (btnApplyIntent) {
        btnApplyIntent.addEventListener("click", () => {
          const summary = summarizeIntent();
          appendReasoning(
            "Applied Design Intent",
            "sketchCAD reinterprets the CM5 Photogrammetry Rig based on the latest Design Intent.\n\n" +
              "In the real version this would drive:\n" +
              "- Block diagram structure\n" +
              "- Top-level schematic connectivity\n" +
              "- PCB outline and connector layout\n" +
              "- BoM contents\n" +
              "- Enclosure dimensions and cutouts\n\n" +
              "Current Design Intent (summary):\n" +
              "“" +
              summary +
              "”"
          );
          setStatus("Design Intent applied. All views pretend to be in sync with this description.");
        });
      }

      if (btnRegenerate) {
        btnRegenerate.addEventListener("click", () => {
          const summary = summarizeIntent();
          appendReasoning(
            "Regenerated stack (fake)",
            "sketchCAD pretends to regenerate a full stack for the CM5 Photogrammetry Rig:\n" +
              "- Updates camera count / layout\n" +
              "- Adjusts CM5 + deepX and power routing in the schematic\n" +
              "- Nudges PCB size and connector edges\n" +
              "- Tweaks BoM rows\n" +
              "- Re-derives enclosure parameters for the STEP model\n\n" +
              "Implementation note: this demo is 100% front-end JavaScript; " +
              "no backend or actual AI service is called.\n\n" +
              "Design Intent snapshot:\n" +
              "“" +
              summary +
              "”"
          );
          setStatus("Regeneration complete. Use the tabs to walk through the updated story.");
        });
      }

      // --- Sketch canvas ----------------------------------------------------
      const sketchCanvas = document.getElementById("sketch-canvas");
      const sketchClearBtn = document.getElementById("sketch-clear");
      const sketchApplyBtn = document.getElementById("sketch-apply");

      if (sketchCanvas && sketchCanvas.getContext) {
        const ctx = sketchCanvas.getContext("2d");

        function resizeCanvas() {
          const rect = sketchCanvas.getBoundingClientRect();
          const aspect = sketchCanvas.height / sketchCanvas.width;
          sketchCanvas.width = rect.width || 800;
          sketchCanvas.height = sketchCanvas.width * aspect;
          ctx.lineWidth = 2;
          ctx.lineCap = "round";
          ctx.lineJoin = "round";
          ctx.strokeStyle = "#10a37f";
        }

        resizeCanvas();
        window.addEventListener("resize", resizeCanvas);

        let drawing = false;
        let lastX = 0;
        let lastY = 0;

        function startDrawing(x, y) {
          drawing = true;
          lastX = x;
          lastY = y;
        }

        function drawLine(x, y) {
          if (!drawing) return;
          ctx.beginPath();
          ctx.moveTo(lastX, lastY);
          ctx.lineTo(x, y);
          ctx.stroke();
          lastX = x;
          lastY = y;
        }

        function stopDrawing() {
          drawing = false;
        }

        // Mouse
        sketchCanvas.addEventListener("mousedown", (e) => {
          startDrawing(e.offsetX, e.offsetY);
        });

        sketchCanvas.addEventListener("mousemove", (e) => {
          drawLine(e.offsetX, e.offsetY);
        });

        sketchCanvas.addEventListener("mouseup", stopDrawing);
        sketchCanvas.addEventListener("mouseleave", stopDrawing);

        // Touch
        function getTouchPos(e) {
          const rect = sketchCanvas.getBoundingClientRect();
          const touch = e.touches[0] || e.changedTouches[0];
          return {
            x: touch.clientX - rect.left,
            y: touch.clientY - rect.top,
          };
        }

        sketchCanvas.addEventListener(
          "touchstart",
          (e) => {
            e.preventDefault();
            const pos = getTouchPos(e);
            startDrawing(pos.x, pos.y);
          },
          { passive: false }
        );

        sketchCanvas.addEventListener(
          "touchmove",
          (e) => {
            if (!drawing) return;
            e.preventDefault();
            const pos = getTouchPos(e);
            drawLine(pos.x, pos.y);
          },
          { passive: false }
        );

        sketchCanvas.addEventListener(
          "touchend",
          () => {
            stopDrawing();
          },
          { passive: true }
        );

        if (sketchClearBtn) {
          sketchClearBtn.addEventListener("click", () => {
            ctx.clearRect(0, 0, sketchCanvas.width, sketchCanvas.height);
            appendReasoning(
              "Cleared sketch",
              "The sketch canvas was cleared. You can draw a new layout for CM5, deepX, " +
                "camera connectors, power input and mmWave sensor. No backend communication occurs."
            );
            setStatus("Sketch cleared. Ready for a new napkin diagram.");
          });
        }

        if (sketchApplyBtn) {
          sketchApplyBtn.addEventListener("click", () => {
            appendReasoning(
              "Applied sketch (fake interpretation)",
              "sketchCAD pretends to parse the current sketch into an updated set of blocks, " +
                "a revised top-level schematic and PCB placement, plus a matching BoM and enclosure.\n\n" +
                "For this MVP, the views remain static, but the narrative is that everything is " +
                "derived from your sketch and Design Intent."
            );
            setStatus("Sketch applied. Switch to Blocks / Schematic / PCB to continue the story.");

            const blocksTabButton = document.querySelector(
              '[data-tab-target="tab-blocks"]'
            );
            if (blocksTabButton) blocksTabButton.click();
          });
        }
      }

      // --- Zoom control -----------------------------------------------------
      const zoomRange = document.getElementById("zoom-range");
      const zoomValueEl = document.getElementById("zoom-value");
      const zoomTargets = document.querySelectorAll(".tab-panel-inner");

      function applyZoom() {
        if (!zoomRange) return;
        const percent = parseInt(zoomRange.value || "100", 10);
        const scale = percent / 100;
        if (zoomValueEl) zoomValueEl.textContent = percent + "%";
        zoomTargets.forEach((el) => {
          el.style.transform = "scale(" + scale + ")";
        });
      }

      if (zoomRange) {
        zoomRange.addEventListener("input", applyZoom);
        applyZoom();
      }

      // --- Initial reasoning entry -----------------------------------------
      appendReasoning(
        "Loaded demo project",
        "sketchCAD started with the CM5 Photogrammetry Rig so you can show an end-to-end " +
          "flow: Sketch → Blocks → Schematic → PCB → BoM → Enclosure.\n\n" +
          "This page is 100% static front-end. All “AI” behavior is simulated in JavaScript, " +
          "which makes it easy to host on GitHub Pages or Netlify."
      );
    })();
  </script>
</body>
</html>
